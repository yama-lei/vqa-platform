import{q as u,g as Y,y as Z,A as f,c as ee,o as p,j as c,a as t,r as i,w as n,h as v,B as oe,u as d,C as z,D as te,G as N,l as B,H as ae,I as le,x as I,s as g,J as U,K as ne}from"./vendor-DQ4wclxO.js";import{l as se,d as re}from"./oss-B6tvshPE.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ue={class:"resources-container"},ie={class:"content-section"},de={class:"search-filter-area"},pe={class:"resources-table-container"},me=["onClick"],ve={class:"action-buttons"},_e={class:"pagination-container"},fe={class:"preview-container"},ge={class:"unknown-preview"},ye={__name:"index",setup(be){const T=u(!1),y=u(""),b=u("all"),w=u(1),F=u(10),j=u(0),h=u(!1),V=u(null);u("");const M=u(null),m=u([]),O=o=>{switch(o){case"paper":return"primary";case"code":return"success";case"note":return"warning";case"video":return"danger";default:return"info"}},q=o=>{switch(o){case"paper":return"论文";case"code":return"代码";case"note":return"笔记";case"video":return"视频";default:return"其他"}},S=Y(()=>{let o=m.value;if(b.value!=="all"&&(o=o.filter(e=>e.type===b.value)),y.value){const e=y.value.toLowerCase();o=o.filter(r=>r.name.toLowerCase().includes(e)||r.uploader&&r.uploader.toLowerCase().includes(e))}return j.value=o.length,o}),E=()=>{w.value=1},J=()=>{w.value=1},K=o=>{w.value=o},R=async o=>{try{console.log("开始预览资源:",o),V.value=o,h.value=!0}catch(e){console.error("预览失败:",e),f.error("预览失败，请尝试下载查看")}},$=o=>{if(!o||!o.objectName){f.warning("资源信息不完整，无法下载");return}try{re(o.objectName,o.name),f.success("下载已开始")}catch(e){console.error("下载失败:",e),f.error(`下载失败: ${e.message}`)}},D=o=>{if(!o)return console.log("文件名为空，返回other类型"),"other";const e=decodeURIComponent(o);console.log("解码后的文件名:",e);const r=e.split("/")[0];console.log("类型前缀:",r);let s="other";switch(r){case"paper":s="paper";break;case"code":s="code";break;case"note":s="note";break;case"video":s="video";break;default:console.log("未找到类型前缀，返回other类型")}return console.log("最终确定的文件类型:",s),s};Z(async()=>{T.value=!0;try{const o=await se();console.log("OSS文件列表:",o),o&&o.length>0&&(m.value=o.map(e=>{const r=D(e.objectName||e.name);return console.log(`文件 ${e.objectName||e.name} 的类型被确定为:`,r),{name:e.name,type:r,url:e.url,objectName:e.objectName||e.name,uploadTime:new Date(e.lastModified).toLocaleString(),uploader:"系统用户",description:""}})),P()}catch(o){console.error("获取资源列表失败:",o),f.error("获取资源列表失败")}finally{T.value=!1}M.value={region:"oss-cn-nanjing",bucket:"vqaplatform"}});const P=()=>{const o=localStorage.getItem("uploadHistory");if(o)try{const r=JSON.parse(o).map(a=>{const k=D(a.objectName||a.fileName);return console.log(`上传历史中的文件 ${a.objectName||a.fileName} 的类型被确定为:`,k),{name:a.fileName,type:k,url:a.url,objectName:a.objectName||a.fileName,uploadTime:a.uploadTime,uploader:"当前用户",description:a.description||""}}),s=new Set(m.value.map(a=>a.objectName)),x=r.filter(a=>!s.has(a.objectName));m.value=[...m.value,...x],j.value=m.value.length}catch(e){console.error("转换上传历史失败:",e)}};return(o,e)=>{var H;const r=i("el-input"),s=i("el-tab-pane"),x=i("el-tabs"),a=i("el-icon"),k=i("el-empty"),_=i("el-table-column"),A=i("el-tag"),C=i("el-button"),G=i("el-table"),Q=i("el-pagination"),W=i("el-dialog"),X=te("loading");return p(),ee("div",ue,[e[10]||(e[10]=c("div",{class:"page-header"},[c("h1",null,"资源中心"),c("p",{class:"header-subtitle"},"浏览和下载小组共享的学习资料、论文、代码和笔记")],-1)),c("div",ie,[c("div",de,[t(r,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=l=>y.value=l),placeholder:"搜索资源","prefix-icon":"Search",clearable:"",class:"search-input",onInput:J},null,8,["modelValue"]),t(x,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=l=>b.value=l),onTabClick:E,class:"resource-tabs"},{default:n(()=>[t(s,{label:"全部",name:"all"}),t(s,{label:"论文",name:"paper"}),t(s,{label:"代码",name:"code"}),t(s,{label:"笔记",name:"note"}),t(s,{label:"视频",name:"video"})]),_:1},8,["modelValue"])]),c("div",pe,[S.value.length?oe((p(),v(G,{key:1,data:S.value,style:{width:"100%"},class:"resources-table"},{default:n(()=>[t(_,{label:"资源名称",prop:"name"},{default:n(l=>[c("div",{class:"resource-name",onClick:L=>R(l.row)},[t(a,null,{default:n(()=>[l.row.type==="paper"||l.row.type==="note"?(p(),v(d(B),{key:0})):N("",!0),l.row.type==="code"?(p(),v(d(ae),{key:1})):N("",!0),l.row.type==="video"?(p(),v(d(le),{key:2})):N("",!0),l.row.type==="other"?(p(),v(d(z),{key:3})):N("",!0)]),_:2},1024),c("span",null,I(l.row.name),1)],8,me)]),_:1}),t(_,{label:"类型",prop:"type",width:"120"},{default:n(l=>[t(A,{type:O(l.row.type),effect:"light",class:"resource-tag"},{default:n(()=>[g(I(q(l.row.type)),1)]),_:2},1032,["type"])]),_:1}),t(_,{label:"上传时间",prop:"uploadTime",width:"180"}),t(_,{label:"上传者",prop:"uploader",width:"120"}),t(_,{label:"操作",width:"180"},{default:n(l=>[c("div",ve,[t(C,{size:"small",class:"download-btn",onClick:L=>$(l.row)},{default:n(()=>[t(a,null,{default:n(()=>[t(d(U))]),_:1}),e[5]||(e[5]=g("下载 "))]),_:2},1032,["onClick"]),t(C,{size:"small",type:"primary",class:"preview-btn",onClick:L=>R(l.row)},{default:n(()=>[t(a,null,{default:n(()=>[t(d(ne))]),_:1}),e[6]||(e[6]=g("预览 "))]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[X,T.value]]):(p(),v(k,{key:0,description:"暂无资源",class:"empty-resources"},{image:n(()=>[t(a,{class:"empty-icon"},{default:n(()=>[t(d(z))]),_:1})]),_:1})),c("div",_e,[t(Q,{background:"",layout:"prev, pager, next",total:j.value,"current-page":w.value,"page-size":F.value,onCurrentChange:K},null,8,["total","current-page","page-size"])])])]),t(W,{modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=l=>h.value=l),title:(H=V.value)==null?void 0:H.name,width:"80%","destroy-on-close":"",class:"preview-dialog"},{footer:n(()=>[t(C,{onClick:e[2]||(e[2]=l=>h.value=!1)},{default:n(()=>e[8]||(e[8]=[g("关闭")])),_:1}),t(C,{type:"primary",onClick:e[3]||(e[3]=l=>$(V.value))},{default:n(()=>[t(a,null,{default:n(()=>[t(d(U))]),_:1}),e[9]||(e[9]=g("下载 "))]),_:1})]),default:n(()=>[c("div",fe,[c("div",ge,[t(a,{class:"preview-icon"},{default:n(()=>[t(d(B))]),_:1}),e[7]||(e[7]=c("p",null,"该文件类型暂不支持预览，请下载后查看",-1))])])]),_:1},8,["modelValue","title"])])}}},Ce=ce(ye,[["__scopeId","data-v-508eeb20"]]);export{Ce as default};
