import{s as v,h as oe,M as ae,A as ne,r as h,c as p,o as _,k as s,a as n,w as i,u as w,N as he,j as le,F as P,x as F,O as K,n as ve,y as k,P as fe,t as O,B as J,Q as ge,H as U,R as ye,S as Ce,T as Ie,U as ke,V as we,W as ee}from"./vendor-Db9bRTJQ.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Se="lIlI****",j={"deepseek-chat":{name:"DeepSeek Chat",description:"支持文本和图像分析的通用大语言模型",supportsMultimodal:!0},"deepseek-reasoner":{name:"DeepSeek Reasoner",description:"具有更强推理能力的大语言模型",supportsMultimodal:!0},"model-1":{name:"模型1",description:"基础视觉问答模型",supportsMultimodal:!0},"model-2":{name:"模型2",description:"增强版视觉问答模型",supportsMultimodal:!0}};async function be(t){try{console.log("发送对话请求到后端:",t);const a={message:t.message,image:t.image||null,history:t.history||[]};t.model&&t.model!=="deepseek-chat"&&(a.model=t.model),console.log("请求体:",a);const e=await fetch("https://api.yama-lei.top/api/chat",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":Se},body:JSON.stringify(a)});if(!e.ok){if(e.status===401||e.status===403)throw new Error("API密钥无效或未授权");const c=await e.json().catch(()=>({}));throw new Error(c.error||`服务器响应错误: ${e.status}`)}const r=await e.json();return console.log("后端响应数据:",r),{text:r.content,image:null}}catch(a){throw console.error("对话API请求失败:",a),a}}function Ae(){return Object.keys(j)}function z(t){return j[t]||null}function xe(t){const a=j[t];return a?a.supportsMultimodal:!1}const S={CHATS:"vqa_chats",CURRENT_CHAT_ID:"vqa_current_chat_id"},D=()=>{try{const t=localStorage.getItem(S.CHATS);return t?JSON.parse(t):[]}catch(t){return console.error("获取聊天记录失败:",t),[]}},W=()=>localStorage.getItem(S.CURRENT_CHAT_ID),Y=t=>{localStorage.setItem(S.CURRENT_CHAT_ID,t)},G=t=>{try{localStorage.setItem(S.CHATS,JSON.stringify(t))}catch(a){console.error("保存聊天记录失败:",a)}},te=t=>D().find(e=>e.id===t)||null,Me=t=>{const a=D(),e=`chat_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,r={id:e,modelId:t,title:"新对话",createdAt:Date.now(),updatedAt:Date.now(),messages:[]};return a.unshift(r),G(a),Y(e),e},se=(t,a)=>{const e=D(),r=e.findIndex(c=>c.id===t);if(r===-1)return!1;if(e[r].messages||(e[r].messages=[]),e[r].messages.push(a),a.role==="user"&&e[r].messages.length<=2){const c=a.content.text||"图片对话";e[r].title=c.substring(0,20)+(c.length>20?"...":"")}return e[r].updatedAt=Date.now(),G(e),!0},Te=t=>{let a=D();const e=a.length;return a=a.filter(r=>r.id!==t),a.length===e?!1:(G(a),W()===t&&(a.length>0?Y(a[0].id):localStorage.removeItem(S.CURRENT_CHAT_ID)),!0)},Re=()=>{try{return localStorage.removeItem(S.CHATS),localStorage.removeItem(S.CURRENT_CHAT_ID),!0}catch(t){return console.error("清空聊天记录失败:",t),!1}},De={class:"chat-history"},$e={class:"history-header"},Ne={class:"history-list"},Ee=["onClick"],He={class:"item-content"},Ve={class:"item-info"},Le={class:"item-title"},Be={class:"item-time"},Ue={class:"item-actions"},ze={class:"history-footer"},Oe={__name:"ChatHistory",props:{modelId:{type:String,required:!0}},emits:["select-chat","create-chat"],setup(t,{emit:a}){const e=t,r=a,c=v([]),b=v("");oe(()=>!e.modelId||!c.value||!c.value.length?[]:c.value.filter(d=>d.modelId===e.modelId));const f=()=>{c.value=D(),b.value=W()},y=d=>{b.value=d,Y(d),r("select-chat",d)},A=()=>{r("create-chat")},g=d=>{Te(d)&&(f(),J.success("对话已删除"))},R=()=>{Re(),f(),J.success("所有对话历史已清空"),r("create-chat")},$=d=>{if(!d)return"";const m=new Date(d),C=new Date().getTime()-m.getTime();return C<24*60*60*1e3?m.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):C<7*24*60*60*1e3?["周日","周一","周二","周三","周四","周五","周六"][m.getDay()]:m.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})};return ae(()=>e.modelId,()=>{f()}),ne(()=>{f()}),(d,m)=>{const x=h("el-icon"),C=h("el-button"),q=h("el-empty"),M=h("el-popconfirm");return _(),p("div",De,[s("div",$e,[m[0]||(m[0]=s("h3",null,"历史对话",-1)),n(C,{onClick:A,type:"primary",size:"small",circle:""},{default:i(()=>[n(x,null,{default:i(()=>[n(w(he))]),_:1})]),_:1})]),s("div",Ne,[c.value.length?(_(!0),p(P,{key:1},F(c.value,I=>(_(),p("div",{key:I.id,class:K(["history-item",{active:b.value===I.id}]),onClick:N=>y(I.id)},[s("div",He,[n(x,null,{default:i(()=>[n(w(ve))]),_:1}),s("div",Ve,[s("div",Le,k(I.title),1),s("div",Be,k($(I.updatedAt)),1)])]),s("div",Ue,[n(M,{title:"确定删除此对话？","confirm-button-text":"确定","cancel-button-text":"取消",onConfirm:N=>g(I.id),width:"200"},{reference:i(()=>[n(C,{type:"danger",size:"small",circle:""},{default:i(()=>[n(x,null,{default:i(()=>[n(w(fe))]),_:1})]),_:1})]),_:2},1032,["onConfirm"])])],10,Ee))),128)):(_(),le(q,{key:0,description:"暂无历史对话"}))]),s("div",ze,[n(M,{title:"确定清空所有对话历史？","confirm-button-text":"确定","cancel-button-text":"取消",onConfirm:R,width:"220"},{reference:i(()=>[n(C,{type:"danger",size:"small",plain:""},{default:i(()=>m[1]||(m[1]=[O("清空历史")])),_:1})]),_:1})])])}}},je=re(Oe,[["__scopeId","data-v-7aa8ff74"]]),qe={class:"model-chat-container"},Pe={class:"chat-layout"},Fe={class:"sidebar"},Ke={class:"main-content"},Je={class:"model-selector"},We={class:"chat-container"},Ye={key:0,class:"empty-chat"},Ge={class:"message-avatar"},Qe={class:"message-content"},Xe={class:"message-role"},Ze={key:0,class:"message-text"},et={key:1,class:"message-image"},tt={key:0,class:"message-item assistant"},st={class:"message-avatar"},ot={class:"message-content"},at={class:"message-role"},nt={class:"input-area"},lt={key:0,class:"image-preview"},rt={class:"input-container"},ct={class:"action-buttons"},it={__name:"index",setup(t){const a=v("ChatLineRound"),e=v("deepseek-chat"),r=v([]),c=v(""),b=v(null),f=v(""),y=v(""),A=v(null),g=v(!1),R=v(null),$=oe(()=>!!f.value.trim()||!!y.value),d=()=>xe(e.value),m=()=>{const o=z(e.value);return o?o.name:"助手"},x=()=>{const o=z(e.value);return o?`欢迎使用 ${o.name}`:"欢迎开始新对话"},C=()=>{const o=z(e.value);if(!o)return"请输入您的问题，AI助手将为您提供回答。";switch(e.value){case"deepseek-chat":return"DeepSeek Chat 是一个功能强大的大语言模型，支持文本和图像分析，可以回答问题、描述图像并进行聊天对话。";case"deepseek-reasoner":return"DeepSeek Reasoner 是一个专注于推理能力的大语言模型，具有更强的逻辑分析和推理能力，适合复杂问题求解。";case"model-1":return"模型1是我们小组开发的视觉问答模型，支持文本和图像输入，能够针对上传的图片回答问题。";case"model-2":return"模型2是我们小组开发的增强版视觉问答模型，具有更强的分析和理解能力，支持文本和图像输入。";default:return`${o.name}：${o.description}`}},q=()=>{ee(()=>{var o;(o=b.value)==null||o.focus()})},M=()=>{ee(()=>{A.value&&(A.value.scrollTop=A.value.scrollHeight)})},I=o=>{if(!o)return;const l=new FileReader;l.onload=T=>{y.value=T.target.result},l.readAsDataURL(o.raw)},N=()=>{y.value="",R.value&&R.value.clearFiles()},Q=async()=>{if(!$.value||g.value)return;c.value||E();const o={role:"user",content:{text:f.value.trim(),image:y.value||null}};r.value.push(o),se(c.value,o),f.value="",N(),M(),g.value=!0;try{const l=r.value.slice(0,-1).map(H=>({role:H.role,content:H.content.text})),T=await be({model:e.value,message:o.content.text,image:o.content.image,history:l});r.value.push({role:"assistant",content:{text:T.text||"",image:null}}),se(c.value,{role:"assistant",content:{text:T.text||"",image:null}}),M()}catch(l){console.error("Error in chat:",l),J.error("发送失败："+(l.message||"未知错误"))}finally{g.value=!1}},E=()=>{const o=j[e.value]?e.value:"deepseek-chat",l=Me(o);c.value=l,r.value=[]},ce=o=>{if(o===c.value)return;const l=te(o);l&&(c.value=o,e.value=l.modelId,r.value=l.messages||[],M())},ie=()=>{E()};ae(()=>e.value,()=>{}),ne(()=>{const o=W();if(o){const l=te(o);if(l){c.value=o,e.value=l.modelId,r.value=l.messages||[];return}}E()});const ue=()=>Ae(),de=o=>z(o);return(o,l)=>{const T=h("el-radio-button"),H=h("el-radio-group"),V=h("el-icon"),L=h("el-button"),X=h("el-avatar"),Z=h("el-image"),_e=h("el-input"),me=h("el-upload"),pe=h("el-tooltip");return _(),p("div",qe,[l[5]||(l[5]=s("div",{class:"header-area"},[s("div",{class:"header-content"},[s("h1",{class:"title"},"模型对话"),s("p",{class:"description"},"与多种AI模型进行对话，探索不同模型的能力")])],-1)),s("div",Pe,[s("div",Fe,[n(je,{"model-id":e.value,onSelectChat:ce,onCreateChat:E},null,8,["model-id"])]),s("div",Ke,[s("div",Je,[n(H,{modelValue:e.value,"onUpdate:modelValue":l[0]||(l[0]=u=>e.value=u),onChange:ie,size:"large"},{default:i(()=>[(_(!0),p(P,null,F(ue(),u=>(_(),le(T,{key:u,label:u},{default:i(()=>{var B;return[O(k(((B=de(u))==null?void 0:B.name)||u),1)]}),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),s("div",We,[r.value.length?(_(),p("div",{key:1,ref_key:"messagesRef",ref:A,class:"messages-list"},[(_(!0),p(P,null,F(r.value,(u,B)=>(_(),p("div",{key:B,class:K(["message-item",u.role])},[s("div",Ge,[n(X,{icon:u.role==="user"?w(we):a.value},null,8,["icon"])]),s("div",Qe,[s("div",Xe,k(u.role==="user"?"用户":m()),1),u.content.text?(_(),p("div",Ze,k(u.content.text),1)):U("",!0),u.content.image?(_(),p("div",et,[n(Z,{src:u.content.image,fit:"contain","preview-src-list":[u.content.image]},null,8,["src","preview-src-list"])])):U("",!0)])],2))),128)),g.value?(_(),p("div",tt,[s("div",st,[n(X,{icon:a.value},null,8,["icon"])]),s("div",ot,[s("div",at,k(m()),1),l[3]||(l[3]=s("div",{class:"message-loading"},[s("span"),s("span"),s("span")],-1))])])):U("",!0)],512)):(_(),p("div",Ye,[n(V,null,{default:i(()=>[n(w(ge))]),_:1}),s("h3",null,k(x()),1),s("p",null,k(C()),1),n(L,{type:"primary",onClick:q},{default:i(()=>l[2]||(l[2]=[O("开始对话")])),_:1})])),s("div",nt,[y.value?(_(),p("div",lt,[n(Z,{src:y.value,fit:"cover"},null,8,["src"]),n(L,{type:"danger",circle:"",size:"small",class:"remove-btn",onClick:N},{default:i(()=>[n(V,null,{default:i(()=>[n(w(ye))]),_:1})]),_:1})])):U("",!0),s("div",rt,[n(_e,{ref_key:"inputRef",ref:b,modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=u=>f.value=u),placeholder:"输入您的问题...",disabled:g.value,onKeyup:Ce(Q,["enter","native"])},null,8,["modelValue","disabled"]),s("div",ct,[n(pe,{content:"上传图片",placement:"top",disabled:!d()},{default:i(()=>[s("div",null,[n(me,{ref_key:"uploadRef",ref:R,action:"","auto-upload":!1,"show-file-list":!1,"on-change":I,accept:"image/*"},{default:i(()=>[n(L,{disabled:g.value||!d(),circle:"",class:K({"disabled-upload":!d()})},{default:i(()=>[n(V,null,{default:i(()=>[n(w(Ie))]),_:1})]),_:1},8,["disabled","class"])]),_:1},512)])]),_:1},8,["disabled"]),n(L,{type:"primary",disabled:!$.value||g.value,onClick:Q},{default:i(()=>[n(V,null,{default:i(()=>[n(w(ke))]),_:1}),l[4]||(l[4]=O(" 发送 "))]),_:1},8,["disabled"])])])])])])])])}}},_t=re(it,[["__scopeId","data-v-52a9c03e"]]);export{_t as default};
